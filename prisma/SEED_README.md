# راهنمای Seed و Restore دیتابیس

این سیستم به شما امکان می‌دهد داده‌های فعلی دیتابیس را export کنید و در صورت بروز مشکل، آن‌ها را restore کنید.

## Export داده‌های فعلی دیتابیس

برای export کردن تمام داده‌های فعلی دیتابیس:

```bash
npm run db:export
```

این دستور:
- تمام داده‌های دیتابیس را خوانده و در فایل `prisma/seed-data.json` ذخیره می‌کند
- Passwords کاربران را export نمی‌کند (برای امنیت)
- API keys و اطلاعات حساس در settings را export نمی‌کند
- کامنت‌های soft-deleted (deletedAt != null) را export نمی‌کند

## Restore داده‌ها

برای restore کردن داده‌ها از فایل seed:

```bash
npm run db:seed
```

این دستور:
- اگر فایل `prisma/seed-data.json` وجود داشته باشد، از آن استفاده می‌کند
- اگر فایل وجود نداشته باشد، از داده‌های پیش‌فرض استفاده می‌کند
- داده‌ها را به صورت upsert می‌کند (اگر وجود داشته باشند update، وگرنه create)
- برای کاربر admin، password پیش‌فرض `admin123` تنظیم می‌شود

## نکات مهم

1. **امنیت**: 
   - Passwords کاربران در export ذخیره نمی‌شوند
   - API keys و اطلاعات حساس در export ذخیره نمی‌شوند
   - بعد از restore، کاربر admin باید password خود را تغییر دهد

2. **فایل seed-data.json**:
   - این فایل شامل تمام داده‌های export شده است
   - می‌توانید این فایل را در Git commit کنید (البته توجه کنید که شامل داده‌های حساس نیست)
   - یا می‌توانید آن را به صورت backup نگه دارید

3. **Restore در دیتابیس خالی**:
   - اگر دیتابیس خالی است، می‌توانید مستقیماً `npm run db:seed` را اجرا کنید
   - ابتدا باید schema را migrate کنید: `npm run db:migrate`

4. **به‌روزرسانی داده‌ها**:
   - قبل از هر تغییر مهم، بهتر است داده‌ها را export کنید
   - می‌توانید این کار را به صورت دوره‌ای انجام دهید

## مثال استفاده

```bash
# 1. Export داده‌های فعلی
npm run db:export

# 2. در صورت بروز مشکل، restore کنید
npm run db:seed

# 3. یا اگر می‌خواهید از صفر شروع کنید:
npm run db:migrate
npm run db:seed
```

