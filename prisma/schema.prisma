generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bad_words {
  id        String   @id
  word      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([word])
}

model bookmarks {
  id        String   @id
  userId    String
  listId    String
  createdAt DateTime @default(now())
  lists     lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model categories {
  id               String            @id
  name             String
  slug             String            @unique
  icon             String
  color            String            @default("#6366F1")
  description      String?
  order            Int               @default(0)
  isActive         Boolean           @default(true)
  commentsEnabled  Boolean           @default(true)  // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù†Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  lists            lists[]
  suggested_lists  suggested_lists[]
}

model comment_likes {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())
  comments  comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model comment_penalties {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  adminId      String
  penaltyScore Int      @default(0)
  action       String   @default("delete")
  createdAt    DateTime @default(now())
  comments     comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([commentId])
  @@index([userId])
}

model comment_reports {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  reason       String?
  resolved     Boolean  @default(false)
  createdAt    DateTime @default(now())
  penaltyScore Int?     @default(0)
  comments     comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([resolved])
  @@index([userId])
}

model comments {
  id                String              @id @default(cuid())
  itemId            String
  userId            String
  content           String
  isFiltered        Boolean             @default(false)
  isApproved        Boolean             @default(true)
  likeCount         Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  deletedAt         DateTime?
  comment_likes     comment_likes[]
  comment_penalties comment_penalties[]
  comment_reports   comment_reports[]
  items             items               @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([deletedAt])
  @@index([isApproved])
  @@index([isFiltered])
  @@index([itemId])
  @@index([userId])
}

model item_votes {
  id        String   @id
  userId    String
  itemId    String
  value     Int
  createdAt DateTime @default(now())
  items     items    @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId])
  @@index([itemId])
  @@index([userId])
}

model item_reports {
  id             String   @id @default(cuid())
  itemId         String
  userId         String
  reason         String   // incorrect_info, offensive, spam, wrong_category, duplicate, other
  description    String?  // ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ reason: other
  weightSnapshot Float?   // ÙˆØ²Ù† Ù„Ø­Ø¸Ù‡ Ø«Ø¨Øª (User Trust Ã— Report Type) Ø¨Ø±Ø§ÛŒ Auto Flagging
  resolved       Boolean  @default(false)
  createdAt      DateTime @default(now())
  penaltyScore   Int?     @default(0)
  items          items    @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([resolved])
  @@index([userId])
}

// Vibe Moderation Engine v1 â€“ Weighted Flag Score Ùˆ ÙˆØ¶Ø¹ÛŒØª Ù†Ù…Ø§ÛŒØ´
model item_moderation {
  id          String              @id @default(cuid())
  itemId      String              @unique
  flagScore   Float               @default(0)
  status      ItemModerationStatus @default(NORMAL)
  lastUpdated DateTime            @updatedAt
  items       items               @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([flagScore])
}

model items {
  id               String         @id
  title            String
  description      String?
  imageUrl         String?
  externalUrl      String?
  listId           String
  order            Int            @default(0)
  metadata         Json?
  voteCount        Int            @default(0)
  rating           Float          @default(0)
  maxComments      Int?           // Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ù…Ù†Øª
  commentsEnabled  Boolean        @default(true)  // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ú©Ø§Ù…Ù†Øª
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  comments         comments[]
  item_votes       item_votes[]
  item_reports     item_reports[]
  item_moderation  item_moderation?
  lists            lists          @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model list_likes {
  id        String   @id
  userId    String
  listId    String
  createdAt DateTime @default(now())
  lists     lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

// Quick reactions: one per user per list (ğŸ’• Ø¹Ø§Ø´Ù‚Ø´ Ø´Ø¯Ù… | ğŸ˜­ Ø§Ø´Ú©Ù… Ø¯Ø±Ø§ÙˆÙ…Ø¯ | ğŸŒ™ Ù…Ù†Ø§Ø³Ø¨ Ø´Ø¨ Ø¨ÙˆØ¯ | ğŸ˜ Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ø¨ÙˆØ¯ | â• ÛŒÙ‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ø§Ø±Ù…)
model list_reactions {
  id           String   @id @default(cuid())
  listId       String
  userId       String
  reactionType String   // love | cry | night | meh | suggestion
  createdAt    DateTime @default(now())
  lists        lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model lists {
  id               String            @id
  title            String
  slug             String            @unique
  description      String?
  coverImage       String?
  categoryId       String?
  userId           String
  tags             String[]          @default([])  // Ø¨Ø±Ø§ÛŒ Similar Lists Ù‡ÙˆØ´Ù…Ù†Ø¯
  badge            ListBadge?
  isPublic         Boolean           @default(true)
  isFeatured       Boolean           @default(false)
  viewCount        Int               @default(0)
  likeCount        Int               @default(0)
  saveCount        Int               @default(0)
  itemCount        Int               @default(0)
  commentsEnabled  Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  isActive         Boolean           @default(true)
  bookmarks        bookmarks[]
  items            items[]
  list_likes       list_likes[]
  list_reactions   list_reactions[]
  suggested_items  suggested_items[]
  list_comments    list_comments[]
  categories       categories?       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users            users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([createdAt])
  @@index([userId])
}

model settings {
  id                           String   @id @default("settings")
  openaiApiKey                 String?
  tmdbApiKey                   String?
  liaraBucketName              String?
  liaraEndpoint                String?
  liaraAccessKey               String?
  liaraSecretKey               String?
  updatedAt                    DateTime
  createdAt                    DateTime @default(now())
  omdbApiKey                   String?
  googleApiKey                 String?
  googleSearchEngineId         String?
  minItemsForPublicList        Int      @default(5)
  maxPersonalLists             Int      @default(3)
  personalListPublicInstructions String?
}

model user_violations {
  id                String   @id @default(cuid())
  userId            String
  commentId         String?
  violationType     String   @default("bad_word")
  violationCount    Int      @default(1)
  lastViolationDate DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  totalPenaltyScore Int      @default(0)
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([violationType])
}

model users {
  id                   String              @id
  name                 String?
  email                String              @unique
  emailVerified        DateTime?
  image                String?
  password             String?
  role                 UserRole            @default(USER)
  isActive             Boolean             @default(true)
  reputationScore      Int                 @default(0)  // +1 comment, +2 suggestion, -3 removed
  curatorScore         Int                 @default(0)
  curatorLevel         CuratorLevel        @default(EXPLORER)
  viralListsCount      Int                 @default(0)
  totalLikesReceived   Int                 @default(0)
  approvedItemsCount   Int                 @default(0)
  bio                  String?
  username             String?             @unique
  avatarType           AvatarType          @default(DEFAULT)
  avatarId             String?
  avatarStatus         AvatarStatus?       // Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø®ØµÛŒ
  showBadge            Boolean             @default(true)
  allowCommentNotifications Boolean        @default(true)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  bookmarks            bookmarks[]
  comment_likes     comment_likes[]
  comment_penalties comment_penalties[]
  comment_reports   comment_reports[]
  comments          comments[]
  item_votes        item_votes[]
  item_reports      item_reports[]
  list_likes        list_likes[]
  list_reactions    list_reactions[]
  lists             lists[]
  user_violations   user_violations[]
  suggested_items   suggested_items[]
  suggested_lists   suggested_lists[]
  notifications     notifications[]
  list_comment_likes list_comment_likes[]
  list_comment_reports list_comment_reports[]
  list_comment_votes list_comment_votes[]
  list_comments     list_comments[]
  followRelationsAsFollower   follows[] @relation("FollowsAsFollower")
  followRelationsAsFollowing  follows[] @relation("FollowsAsFollowing")
  user_achievements           user_achievements[]
  creator_ranking             creator_rankings?
  user_category_affinity     user_category_affinity[]
  discovery_spotlight_cache  discovery_spotlight_cache?
  creator_spotlights         creator_spotlights[]
}

model creator_spotlights {
  id           String    @id @default(cuid())
  userId       String
  type         String    // weekly | rising | category | editor
  categorySlug String?
  startDate    DateTime
  endDate      DateTime
  createdBy    String?   // admin userId if editor pick
  users        users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([startDate, endDate])
  @@index([userId])
}

model discovery_spotlight_cache {
  id         String   @id @default(cuid())
  userId     String   @unique
  creatorId  String
  explanation String?
  updatedAt  DateTime @updatedAt
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([updatedAt])
}

model user_category_affinity {
  id           String   @id @default(cuid())
  userId       String
  categorySlug String
  weight       Float    @default(0)
  updatedAt   DateTime @updatedAt
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, categorySlug])
  @@index([userId])
}

model creator_rankings {
  id                 String   @id @default(cuid())
  userId             String   @unique
  curatorScore       Int      @default(0)
  influenceScore     Int      @default(0)
  momentumScore      Int      @default(0)
  rankingScore       Float    @default(0)
  globalRank         Int      @default(0)
  previousGlobalRank Int?     // for rank change indicator
  monthlyRank        Int?     // current month rank (reset monthly)
  monthYear          String?  // e.g. "2025-02"
  categoryRank       Json?    // { "film": 1, "book": 3 } slug -> rank
  lastUpdated        DateTime @updatedAt
  lastActivityAt     DateTime? // for decay: last list/bookmark/comment activity
  users              users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([rankingScore])
  @@index([globalRank])
  @@index([momentumScore])
  @@index([monthlyRank])
}

model achievements {
  id          String   @id @default(cuid())
  code        String   @unique
  title       String
  description String
  category    String   // creation | impact | community | consistency
  tier        String   @default("bronze") // bronze | silver | gold | elite
  icon        String   // emoji or icon key
  isSecret    Boolean  @default(false)
  user_achievements user_achievements[]

  @@index([category])
}

model user_achievements {
  id            String       @id @default(cuid())
  userId        String
  achievementId String
  unlockedAt    DateTime     @default(now())
  users         users        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievements  achievements @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
  @@index([achievementId])
}

model follows {
  id          String   @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  follower    users    @relation("FollowsAsFollower", fields: [followerId], references: [id], onDelete: Cascade)
  following   users    @relation("FollowsAsFollowing", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followingId])
  @@index([followerId])
}

enum ItemModerationStatus {
  NORMAL       // ÙÙ‚Ø· Ø«Ø¨Øª
  SOFT_FLAG    // Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø¨ÛŒÙ†Ø¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ø¹Ø§Ø¯ÛŒ
  UNDER_REVIEW // Ø§Ø² ØªØ±Ù†Ø¯/Ø§Ø³Ù¾Ø§ØªÙ„Ø§ÛŒØª Ø­Ø°ÙØŒ Ø§ÙˆÙ„ÙˆÛŒØª Ù¾Ø§ÛŒÛŒÙ†
  HIDDEN       // Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒØŒ ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ùˆ Ø³Ø§Ø²Ù†Ø¯Ù‡
}

enum ListBadge {
  TRENDING
  NEW
  FEATURED
}

enum UserRole {
  USER
  EDITOR
  ADMIN
}

enum CuratorLevel {
  EXPLORER           // 0â€“49
  NEW_CURATOR        // 50â€“149
  ACTIVE_CURATOR     // 150â€“299
  TRUSTED_CURATOR    // 300â€“499
  INFLUENTIAL_CURATOR // 500â€“799
  ELITE_CURATOR      // 800â€“1199
  VIBE_LEGEND        // 1200+
}

enum AvatarType {
  DEFAULT   // Ø¢ÙˆØ§ØªØ§Ø± ÙˆØ§ÛŒØ¨
  UPLOADED  // Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø®ØµÛŒ
}

enum AvatarStatus {
  APPROVED
  PENDING
  REJECTED
}

model comment_settings {
  id                      String   @id @default(cuid())
  defaultMaxComments      Int?     // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
  defaultCommentsEnabled  Boolean  @default(true)
  maxCommentLength        Int?     // Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…Ù†Øª (null = Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª)
  rateLimitMinutes        Int      @default(5)  // Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø¢ÛŒØªÙ… (Ø¯Ù‚ÛŒÙ‚Ù‡)
  globalRateLimitMinutes  Int?     // Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ (null = ØºÛŒØ±ÙØ¹Ø§Ù„)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model suggested_items {
  id          String   @id @default(cuid())
  title       String
  description String?
  imageUrl    String?
  externalUrl String?
  listId      String
  userId      String
  metadata    Json?
  status      String   @default("pending") // pending, approved, rejected
  adminNotes  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lists       lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([listId])
  @@index([userId])
  @@index([status])
}

model suggested_lists {
  id          String     @id @default(cuid())
  title       String
  description String?
  coverImage  String?
  categoryId  String
  userId      String
  status      String     @default("pending") // pending, approved, rejected
  adminNotes  String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  categories  categories @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users       users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([userId])
  @@index([status])
}

model notifications {
  id        String   @id @default(cuid())
  userId    String
  type      String   // 'suggestion_approved', 'suggestion_rejected', 'admin_message', etc.
  title     String
  message   String
  link      String?  // Optional link to related content
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

model list_comments {
  id                 String                @id @default(cuid())
  listId             String
  userId             String
  parentId           String?               // ÛŒÚ© Ø³Ø·Ø­ Ù¾Ø§Ø³Ø®
  type               String                @default("comment")  // comment | suggestion | opinion
  content            String
  contentHash        String?               // Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ ØªÚ©Ø±Ø§Ø±
  suggestionStatus   String?               // pending | approved | rejected
  approvedItemId     String?
  status             String                @default("active")   // active | review | hidden | rejected
  isFiltered         Boolean               @default(false)
  isApproved         Boolean               @default(true)
  likeCount          Int                   @default(0)
  helpfulUp          Int                   @default(0)
  helpfulDown        Int                   @default(0)
  weightedScore      Float                 @default(0)
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  deletedAt         DateTime?
  list_comment_likes list_comment_likes[]
  list_comment_reports list_comment_reports[]
  list_comment_votes list_comment_votes[]
  lists              lists                 @relation(fields: [listId], references: [id], onDelete: Cascade)
  users              users                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent             list_comments?        @relation("ListCommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies            list_comments[]       @relation("ListCommentReplies")

  @@index([createdAt])
  @@index([deletedAt])
  @@index([isApproved])
  @@index([isFiltered])
  @@index([listId])
  @@index([userId])
  @@index([parentId])
  @@index([type])
  @@index([status])
  @@index([weightedScore])
}

model list_comment_likes {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())
  list_comments list_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model list_comment_reports {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  reason       String?
  resolved     Boolean  @default(false)
  createdAt    DateTime @default(now())
  penaltyScore Int?     @default(0)
  list_comments list_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([resolved])
  @@index([userId])
}

model list_comment_votes {
  id        String   @id @default(cuid())
  userId    String
  commentId String
  value     Int      // 1 = helpful, -1 = not helpful
  createdAt DateTime @default(now())
  list_comments list_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
  @@index([commentId])
  @@index([userId])
}
