generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bad_words {
  id        String   @id
  word      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([word])
}

model bookmarks {
  id        String   @id
  userId    String
  listId    String
  createdAt DateTime @default(now())
  lists     lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model categories {
  id          String   @id
  name        String
  slug        String   @unique
  icon        String
  color       String   @default("#6366F1")
  description String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  lists       lists[]
}

model comment_likes {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())
  comments  comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model comment_penalties {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  adminId      String
  penaltyScore Int      @default(0)
  action       String   @default("delete")
  createdAt    DateTime @default(now())
  comments     comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([commentId])
  @@index([userId])
}

model comment_reports {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  reason       String?
  resolved     Boolean  @default(false)
  createdAt    DateTime @default(now())
  penaltyScore Int?     @default(0)
  comments     comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([resolved])
  @@index([userId])
}

model comments {
  id                String              @id @default(cuid())
  itemId            String
  userId            String
  content           String
  isFiltered        Boolean             @default(false)
  isApproved        Boolean             @default(true)
  likeCount         Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  deletedAt         DateTime?
  comment_likes     comment_likes[]
  comment_penalties comment_penalties[]
  comment_reports   comment_reports[]
  items             items               @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([deletedAt])
  @@index([isApproved])
  @@index([isFiltered])
  @@index([itemId])
  @@index([userId])
}

model item_votes {
  id        String   @id
  userId    String
  itemId    String
  value     Int
  createdAt DateTime @default(now())
  items     items    @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId])
  @@index([itemId])
  @@index([userId])
}

model items {
  id          String       @id
  title       String
  description String?
  imageUrl    String?
  externalUrl String?
  listId      String
  order       Int          @default(0)
  metadata    Json?
  voteCount   Int          @default(0)
  rating      Float        @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  comments    comments[]
  item_votes  item_votes[]
  lists       lists        @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model list_likes {
  id        String   @id
  userId    String
  listId    String
  createdAt DateTime @default(now())
  lists     lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model lists {
  id          String       @id
  title       String
  slug        String       @unique
  description String?
  coverImage  String?
  categoryId  String
  userId      String
  badge       ListBadge?
  isPublic    Boolean      @default(true)
  isFeatured  Boolean      @default(false)
  viewCount   Int          @default(0)
  likeCount   Int          @default(0)
  saveCount   Int          @default(0)
  itemCount   Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  isActive    Boolean      @default(true)
  bookmarks   bookmarks[]
  items       items[]
  list_likes  list_likes[]
  categories  categories   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users       users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([createdAt])
  @@index([userId])
}

model settings {
  id                   String   @id @default("settings")
  openaiApiKey         String?
  tmdbApiKey           String?
  liaraBucketName      String?
  liaraEndpoint        String?
  liaraAccessKey       String?
  liaraSecretKey       String?
  updatedAt            DateTime
  createdAt            DateTime @default(now())
  omdbApiKey           String?
  googleApiKey         String?
  googleSearchEngineId String?
}

model user_violations {
  id                String   @id @default(cuid())
  userId            String
  commentId         String?
  violationType     String   @default("bad_word")
  violationCount    Int      @default(1)
  lastViolationDate DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  totalPenaltyScore Int      @default(0)
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([violationType])
}

model users {
  id                String              @id
  name              String?
  email             String              @unique
  emailVerified     DateTime?
  image             String?
  password          String?
  role              UserRole            @default(USER)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  bookmarks         bookmarks[]
  comment_likes     comment_likes[]
  comment_penalties comment_penalties[]
  comment_reports   comment_reports[]
  comments          comments[]
  item_votes        item_votes[]
  list_likes        list_likes[]
  lists             lists[]
  user_violations   user_violations[]
}

enum ListBadge {
  TRENDING
  NEW
  FEATURED
}

enum UserRole {
  USER
  EDITOR
  ADMIN
}
