generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bad_words {
  id        String   @id
  word      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([word])
}

model bookmarks {
  id        String   @id
  userId    String
  listId    String
  createdAt DateTime @default(now())
  lists     lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model categories {
  id               String            @id
  name             String
  slug             String            @unique
  icon             String
  color            String            @default("#6366F1")
  description      String?
  order            Int               @default(0)
  isActive         Boolean           @default(true)
  commentsEnabled  Boolean           @default(true)  // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù†Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  lists            lists[]
  suggested_lists  suggested_lists[]
}

model comment_likes {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())
  comments  comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model comment_penalties {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  adminId      String
  penaltyScore Int      @default(0)
  action       String   @default("delete")
  createdAt    DateTime @default(now())
  comments     comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([commentId])
  @@index([userId])
}

model comment_reports {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  reason       String?
  resolved     Boolean  @default(false)
  createdAt    DateTime @default(now())
  penaltyScore Int?     @default(0)
  comments     comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([resolved])
  @@index([userId])
}

model comments {
  id                String              @id @default(cuid())
  itemId            String
  userId            String
  content           String
  isFiltered        Boolean             @default(false)
  isApproved        Boolean             @default(true)
  likeCount         Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  deletedAt         DateTime?
  comment_likes     comment_likes[]
  comment_penalties comment_penalties[]
  comment_reports   comment_reports[]
  items             items               @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([deletedAt])
  @@index([isApproved])
  @@index([isFiltered])
  @@index([itemId])
  @@index([userId])
}

model item_votes {
  id        String   @id
  userId    String
  itemId    String
  value     Int
  createdAt DateTime @default(now())
  items     items    @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId])
  @@index([itemId])
  @@index([userId])
}

model item_reports {
  id           String   @id @default(cuid())
  itemId       String
  userId       String
  reason       String   // spelling_error, incorrect_info, offensive, other
  description  String?  // ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ reason: other
  resolved     Boolean  @default(false)
  createdAt    DateTime @default(now())
  penaltyScore Int?     @default(0)
  items        items    @relation(fields: [itemId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([resolved])
  @@index([userId])
}

model items {
  id               String         @id
  title            String
  description      String?
  imageUrl         String?
  externalUrl      String?
  listId           String
  order            Int            @default(0)
  metadata         Json?
  voteCount        Int            @default(0)
  rating           Float          @default(0)
  maxComments      Int?           // Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ù…Ù†Øª
  commentsEnabled  Boolean        @default(true)  // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ú©Ø§Ù…Ù†Øª
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  comments         comments[]
  item_votes       item_votes[]
  item_reports     item_reports[]
  lists            lists          @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model list_likes {
  id        String   @id
  userId    String
  listId    String
  createdAt DateTime @default(now())
  lists     lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

// Quick reactions: one per user per list (ğŸ’• Ø¹Ø§Ø´Ù‚Ø´ Ø´Ø¯Ù… | ğŸ˜­ Ø§Ø´Ú©Ù… Ø¯Ø±Ø§ÙˆÙ…Ø¯ | ğŸŒ™ Ù…Ù†Ø§Ø³Ø¨ Ø´Ø¨ Ø¨ÙˆØ¯ | ğŸ˜ Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ø¨ÙˆØ¯ | â• ÛŒÙ‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ø§Ø±Ù…)
model list_reactions {
  id           String   @id @default(cuid())
  listId       String
  userId       String
  reactionType String   // love | cry | night | meh | suggestion
  createdAt    DateTime @default(now())
  lists        lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model lists {
  id               String            @id
  title            String
  slug             String            @unique
  description      String?
  coverImage       String?
  categoryId       String?
  userId           String
  tags             String[]          @default([])  // Ø¨Ø±Ø§ÛŒ Similar Lists Ù‡ÙˆØ´Ù…Ù†Ø¯
  badge            ListBadge?
  isPublic         Boolean           @default(true)
  isFeatured       Boolean           @default(false)
  viewCount        Int               @default(0)
  likeCount        Int               @default(0)
  saveCount        Int               @default(0)
  itemCount        Int               @default(0)
  commentsEnabled  Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  isActive         Boolean           @default(true)
  bookmarks        bookmarks[]
  items            items[]
  list_likes       list_likes[]
  list_reactions   list_reactions[]
  suggested_items  suggested_items[]
  list_comments    list_comments[]
  categories       categories?       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users            users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([createdAt])
  @@index([userId])
}

model settings {
  id                           String   @id @default("settings")
  openaiApiKey                 String?
  tmdbApiKey                   String?
  liaraBucketName              String?
  liaraEndpoint                String?
  liaraAccessKey               String?
  liaraSecretKey               String?
  updatedAt                    DateTime
  createdAt                    DateTime @default(now())
  omdbApiKey                   String?
  googleApiKey                 String?
  googleSearchEngineId         String?
  minItemsForPublicList        Int      @default(5)
  maxPersonalLists             Int      @default(3)
  personalListPublicInstructions String?
}

model user_violations {
  id                String   @id @default(cuid())
  userId            String
  commentId         String?
  violationType     String   @default("bad_word")
  violationCount    Int      @default(1)
  lastViolationDate DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  totalPenaltyScore Int      @default(0)
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([violationType])
}

model users {
  id                String              @id
  name              String?
  email             String              @unique
  emailVerified     DateTime?
  image             String?
  password          String?
  role              UserRole            @default(USER)
  isActive          Boolean             @default(true)
  reputationScore   Int                 @default(0)  // +1 comment, +2 suggestion, -3 removed
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  bookmarks         bookmarks[]
  comment_likes     comment_likes[]
  comment_penalties comment_penalties[]
  comment_reports   comment_reports[]
  comments          comments[]
  item_votes        item_votes[]
  item_reports      item_reports[]
  list_likes        list_likes[]
  list_reactions    list_reactions[]
  lists             lists[]
  user_violations   user_violations[]
  suggested_items   suggested_items[]
  suggested_lists   suggested_lists[]
  notifications     notifications[]
  list_comment_likes list_comment_likes[]
  list_comment_reports list_comment_reports[]
  list_comment_votes list_comment_votes[]
  list_comments     list_comments[]
}

enum ListBadge {
  TRENDING
  NEW
  FEATURED
}

enum UserRole {
  USER
  EDITOR
  ADMIN
}

model comment_settings {
  id                      String   @id @default(cuid())
  defaultMaxComments      Int?     // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
  defaultCommentsEnabled  Boolean  @default(true)
  maxCommentLength        Int?     // Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…Ù†Øª (null = Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª)
  rateLimitMinutes        Int      @default(5)  // Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø¢ÛŒØªÙ… (Ø¯Ù‚ÛŒÙ‚Ù‡)
  globalRateLimitMinutes  Int?     // Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ (null = ØºÛŒØ±ÙØ¹Ø§Ù„)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model suggested_items {
  id          String   @id @default(cuid())
  title       String
  description String?
  imageUrl    String?
  externalUrl String?
  listId      String
  userId      String
  metadata    Json?
  status      String   @default("pending") // pending, approved, rejected
  adminNotes  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lists       lists    @relation(fields: [listId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([listId])
  @@index([userId])
  @@index([status])
}

model suggested_lists {
  id          String     @id @default(cuid())
  title       String
  description String?
  coverImage  String?
  categoryId  String
  userId      String
  status      String     @default("pending") // pending, approved, rejected
  adminNotes  String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  categories  categories @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users       users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([userId])
  @@index([status])
}

model notifications {
  id        String   @id @default(cuid())
  userId    String
  type      String   // 'suggestion_approved', 'suggestion_rejected', 'admin_message', etc.
  title     String
  message   String
  link      String?  // Optional link to related content
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

model list_comments {
  id                 String                @id @default(cuid())
  listId             String
  userId             String
  parentId           String?               // ÛŒÚ© Ø³Ø·Ø­ Ù¾Ø§Ø³Ø®
  type               String                @default("comment")  // comment | suggestion | opinion
  content            String
  contentHash        String?               // Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ ØªÚ©Ø±Ø§Ø±
  suggestionStatus   String?               // pending | approved | rejected
  approvedItemId     String?
  status             String                @default("active")   // active | review | hidden | rejected
  isFiltered         Boolean               @default(false)
  isApproved         Boolean               @default(true)
  likeCount          Int                   @default(0)
  helpfulUp          Int                   @default(0)
  helpfulDown        Int                   @default(0)
  weightedScore      Float                 @default(0)
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  deletedAt         DateTime?
  list_comment_likes list_comment_likes[]
  list_comment_reports list_comment_reports[]
  list_comment_votes list_comment_votes[]
  lists              lists                 @relation(fields: [listId], references: [id], onDelete: Cascade)
  users              users                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent             list_comments?        @relation("ListCommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies            list_comments[]       @relation("ListCommentReplies")

  @@index([createdAt])
  @@index([deletedAt])
  @@index([isApproved])
  @@index([isFiltered])
  @@index([listId])
  @@index([userId])
  @@index([parentId])
  @@index([type])
  @@index([status])
  @@index([weightedScore])
}

model list_comment_likes {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())
  list_comments list_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model list_comment_reports {
  id           String   @id @default(cuid())
  commentId    String
  userId       String
  reason       String?
  resolved     Boolean  @default(false)
  createdAt    DateTime @default(now())
  penaltyScore Int?     @default(0)
  list_comments list_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([resolved])
  @@index([userId])
}

model list_comment_votes {
  id        String   @id @default(cuid())
  userId    String
  commentId String
  value     Int      // 1 = helpful, -1 = not helpful
  createdAt DateTime @default(now())
  list_comments list_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
  @@index([commentId])
  @@index([userId])
}
